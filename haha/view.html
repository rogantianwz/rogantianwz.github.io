<p>主要从三个方面来讲，一是本职工作，主要讲我在焦点的这些时间都做了些什么。二是讲效率提升，主要讲为了提高team的协作，提高工作的效率都做了些什么。三是讲用户体验，讲的是为了提高用户的使用体验都做了些什么。这三个方面分别说的是做了什么，怎么做和怎么做好。</p>

<ol>
<li>焦点wap开发维护</li>
<li>测试与持续集成</li>
<li>静态资源管理</li>
<li>分享与培训 </li>
<li>wap页面访问优化</li>
</ol>



<h3 id="焦点wap开发维护">焦点wap开发维护</h3>

<ol>
<li>首先是做了什么？这里有三个关键词，一是“从13年8月到现在 <br>
”，是说我从03年8月入职到现在一直在做焦点的wap站，也就是移动web，在我入职的时候，移动web项目刚启动2周，我作为developer加入项目组，到现在移动web项目经历了三个大的版本迭代，无数个小的迭代，我一直在这个项目组。第二个关键词是“。。。”，是说在13年年终总结的时候移动web项目获得了公司的肯定，移动web项目在13年10月第一大个版本上线，然后加班加点在年底前确保了第二个大版本的上线，工作内容获得了公司认同。第三个关键词是“从developer到leader”，在移动web第一个大的版本发布之后，我就从developer成为了该项目的技术负责人，参加历次的需求会议，对产品需求提出各种建议，分析需求，分解任务，进度跟踪等，到这一步不是侥幸，因为我对项目的主人翁责任感，不仅仅把自己看成一个developer,而是项目的owner，事关荣辱。</li>
</ol>



<h3 id="测试与持续集成">测试与持续集成。</h3>

<ol>
<li>在移动互联网发展的今天，一个最为明显的特征就是：快速上线，持续迭代。为了能够做到这一点，我们需要在并行开发多个新模块的同时对旧功能进行持续迭代，这个过程中还涉及到与FE、数据中心等同学的联调，QA同学尽快进入测试，对测试ok的功能快速上线。这些都要求项目要有一套完善的持续集成的环境。经过长时间的积累和摸索，形成了如表所示的环境。其中包括wap相关 的测试联调环境有tes.m.focus.cn, jobs.m.focus.cn, qa.m.focus.cn三套,静态资源相关环境有s.m.focus.cn/test, s.m.focus.cn/qa,test.m.focus.cn/online三套。静态资源和java代码的自动部署。这些都是在工作过程中根据需要而制定的，适应现在的开发模式。同时使用了开源的持续集成工具hudson，自动部署java代码。使用github hook自动更新前端代码。做到了一键部署，动静分离，测试与联调很好的隔离。 <br>
还编写了自动测试脚本，防止在迭代的时候意外覆盖//TODO <br>
同时还有监控脚本，监控线上页面。</li>
</ol>



<h3 id="静态资源管理">静态资源管理</h3>

<ol>
<li>起因：为了解决静态资源的版本管理问题。当页面引用的某个静态资源（js,css,png)发生改变的时候，如果不考虑版本管理问题，那么就涉及到要缓存问题，而且不能完全解决问题，因为用户浏览器的缓存没法清除。那使用普通的版本管理方式比如在url后边加上?version=123这种后缀，由于有更新时间间隙的问题会出现访问出错的问题，而且如果使用CDN的话可能会引起CDN攻击。</li>
<li>过程：解决方案是使用hash版本冗余机制。由于我们的项目使用maven来管理，所以考虑做一个maven插件来完成这件事情，然后在使用maven打包的时候自动就把静态资源的版本问题解决了。过程是在打包的时候遍历所有的jsp或者html文件把其中对静态资源的引用都记录下来，然后把这些静态资源从服务器下载下来，计算文件的md5，更改静态资源的文件名，加上md5后缀，like…/a/b/c_${md5}.js。然后将这些该过名的静态资源上传CDN，再把jsp和html中对静态资源的引用都改成带md5的，然后发布。这样做的话只那些修改过的资源md5值发生变化需要重新更新到线上，而且不会影响线上旧的资源</li>
<li>结果：从14年年初使用此插件以来，静态资源管理就不再是问题了，而且部署也很方便。</li>
<li>后续：由于前端团队的壮大，他们开始使用requirejs等框架，现有插件就不能很好的处理了，后续对插件进行过版本更新。现在前端忍受充足，它们准备使用自己的版本管理机制，该方案可能成为历史。</li>
</ol>



<h3 id="分享与培训">分享与培训</h3>

<ol>
<li>XSS</li>
<li>正则</li>
<li>NIO与Netty</li>
</ol>



<h3 id="页面访问体验">页面访问体验</h3>

<p>起因：进行竞品对比的时候，发现咱们的页面从请求开始到页面渲染完成，基本保持在妙级，有的时候能达到3秒，而竞品基本保持在毫秒级别。 <br>
分析：页面的访问速度能够在很大程度上影响用户的使用体验，尤其是我们做的是移动页面。分析了我们与竞品的差异，一个是页面的下载速度，另一个是页面的渲染速度都有待提高 <br>
过程： <br>
    1. 提高页面下载速度：虽然我们在服务端使用了多线程来生成页面，但是在某些复杂的页面其页面生成耗时也在秒级，比如m.focus.cn的首页，这个页面包含了10个模块，每个模块都涉及到1个或者多个rpc调用。相比较竞品，它们的首页也包含数十个模块，但是它们就能做的很好。鉴于此，我们在使用了一些key, value缓存的同时，对一些复杂的页面使用了html页面静态化，引入了ehcache，要引入html静态化需要将html页面中的动态内容以及之前和代码强相关的统计组件剥离出来。 <br>
    2. 提高页面渲染速度：为了提高页面渲染速度，做了以下四件事情。一个是页面上显示图片的地方根据需要显示不同大小的图片；二是推动前端同学对一些暂时不显示的图片做懒加载处理；三是推动前端同学对样式进行css sprite处理，减少rquest数；四是推动另外一个项目叫ImageFilter，这个项目作为一个过滤器工作在web项目中，它把所有页面中的图片自动替换成质量更小又不损失显示效果的新图片。 <br>
结果： <br>
    1. 提高页面下载速度后，首页的下载耗时都是保持在30毫秒以内。 <br>
    2. 提高页面渲染速度后，首页从下载到渲染完成能够保持在200ms左右。</p>

<p><a href="http://www.infoq.com/cn/articles/front-end-engineering-and-performance-optimization-part1/">参考</a></p>

<blockquote>
  <p>Written with <a href="https://stackedit.io/">StackEdit</a>.</p>
</blockquote>